import React, { useState, useEffect } from "react";
import AdminLayout from "../layouts/AdminLayout";
import Head from "next/head";
import DataTable from "react-data-table-component";
import InputGroup from "react-bootstrap/InputGroup";
import Form from "react-bootstrap/Form";
import Button from "react-bootstrap/Button";
import SearchIcon from "../public/images/icons/search-icon.svg";
import OccupationAction from '../public/images/icons/OccupationAction.svg';
import Image from "next/image";
import { useRouter } from 'next/router';
import { BASE_URL } from "../baseURL";


function IncomeAssessmentPage() {
  const [data, setData] = useState([]);
  const [selectedOccupation, setSelectedOccupation] = useState(null);
  const [showTemplate, setShowTemplate] = useState(false);
  const router = useRouter();

  const columns = [
    { name: "#", selector: (row) => row.id },
    { name: "Template Name", selector: (row) => row.templateName },
    { name: "Occupation", selector: (row) => row.occupation },
    { name: "Version", selector: (row) => row.version },
    {
      name: "Created On",
      selector: (row) =>
        new Date(row.createdOn).toLocaleDateString("en-GB", {
          day: "numeric",
          month: "long",
          year: "numeric",
        }),
    },
    {
      name: "Action",
      cell: (row) => (
        <div className="d-flex">
          {/* Add your action buttons here */}
          <Button
            variant=""
            // onClick={() => setSelectedOccupation(row)}
            onClick={() => {
              // console.log(row.occupationID);
              // localStorage.setItem('OccupationID', row.occupationID)
              // router.push('/formgenerator');
              router.push(`/formgenerator?occupationID=${row.occupationID}`);

              setSelectedOccupation(row);
            }}
            style={{ lineHeight: "0.5" }}
            className="occupationActionButton"
          >
            <div className=" d-flex">
              <Image src={OccupationAction} alt=""/>
            </div>
          </Button>
        </div>
      ),
      style: {
        textAlign: "right",
      },
    },
  ];

  useEffect(() => {
    const fetchData = async () => {
      const response = await fetch(`${BASE_URL}/crm/incomeAssessment/templates`);
      const data = await response.json();
      // console.log(data)
      if (response.status === 200) {
        // console.log(data.data)
        const newData = data.data.map((item) => ({
          id: item.id,
          templateName: item.formTitle,
          version: item.version,
          occupation: item.formName,
          createdOn: new Date(item.createdAt),
          occupationID: item.occupationId
          // templateName: item.json.formTitle,
          // version: item.json.version,
          // occupation: item.json.formName,
          // createdOn: new Date(item.createdAt),
        }));
        //  console.log(newData)
        console.log("Get is successful")

        setData(newData);
      } else {
        // Handle the error
        alert("Something went wrong");
      }
    };
    fetchData();
  }, []);


  const HandleClick = () => {
    router.push('/income-assessment-tempate');

  }

  return (
    <div>
      <Head>
        <title>Income Assessment Template</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
        <link
          rel="stylesheet"
          href="https://use.fontawesome.com/releases/v5.13.0/css/all.css"
        />
        <link
          rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossOrigin="anonymous"
        />
      </Head>
      <AdminLayout>


        <div>
          <div className="row toolbar">
            <div className="col-lg-4">
              <InputGroup className="mb-3 ms-3">
                <InputGroup.Text id="basic-addon1">
                  <Image src={SearchIcon} width="18" height="18" alt=""></Image>
                </InputGroup.Text>
                <Form.Control
                  placeholder="Search"
                  aria-label="search"
                  aria-describedby="basic-addon1"
                />
              </InputGroup>
            </div>
            <div className="col-lg-8 d-flex justify-content-end">
              <Button variant="primary me-4" onClick={HandleClick}>
                + Create New
              </Button>
            </div>
          </div>
          <DataTable columns={columns} data={data} pagination />
          {/* {domLoaded ? (
            <DataTable columns={columns} data={data} pagination />
          ) : (
            ""
          )} */}

        </div>
      </AdminLayout>

    </div>
  );
}

export default IncomeAssessmentPage;
